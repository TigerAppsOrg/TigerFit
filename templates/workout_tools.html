<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
</head>

<body>
    <button id="plate-calculator-tool" class="btn-grey btn btn-dark square-btn btn-m-l" data-toggle="modal" data-target="#plate-calculator-modal">A</button>


    <div class="modal fade" id="plate-calculator-modal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header modal-header--sticky">
                    <div class="container-fluid justify-content-center">
                        <div class="row">
                            <h2 class="modal-title col-12 text-center py-1" id="exampleModalLabel" style="font-weight: bolder">
                                Plate Calculator
                            </h2>

                            <button type="button" id="close-modal-button" class="col-1 btn btn-danger btn-red m-3" data-bs-dismiss="modal" style="
                    position: absolute;
                    right: 0;
                    top: 0;
                    width: 30px;
                    height: 30px;
                  ">
                                <i class="fa fa-times" style="position: absolute; right: 7.5px; top: 6px"></i>
                            </button>
                        </div>


                    </div>
                </div>

                <div class="modal-body">
                    <div class="row justify-content-center">
                        <input type="number" id="total-weight-input" placeholder="Goal Weight"><br>

                        <input type="number" id="bar-weight-input" placeholder="Bar Weight"><br>

                        <button id="plate-calculator-button">Calculate</button>

                        <div id="plate-calculator-result"></div>

                        <script>
                            const PLATE_WEIGHTS = [45, 25, 10, 5, 2.5];

                            // Calculates how many of each plate are needed
                            function calculatePlates(totalWeight, barWeight) {
                                const plateCounts = [0, 0, 0, 0, 0];


                                let weightRemaining = (totalWeight - barWeight) / 2;
                                for (let i = 0; i < PLATE_WEIGHTS.length; i++) {
                                    while (weightRemaining >= PLATE_WEIGHTS[i]) {
                                        weightRemaining -= PLATE_WEIGHTS[i];
                                        plateCounts[i]++;
                                    }
                                }

                                return [plateCounts, weightRemaining * 2];
                            }


                            $(document).on('click', '#plate-calculator-button', function () {
                                const totalWeight = parseFloat($('#total-weight-input').val());
                                const barWeight = parseFloat($('#bar-weight-input').val());

                                if (isNaN(totalWeight) || isNaN(barWeight)) {
                                    let resultHTML = '';
                                    $('#plate-calculator-result').html(resultHTML);
                                    return
                                }

                                // Ensures that the weight added to bar is a multiple of 5
                                if ((totalWeight - barWeight) % 5 !== 0) {
                                    let resultHTML = 'Cannot calculate weight';
                                    $('#plate-calculator-result').html(resultHTML);
                                    return
                                }

                                const [plateCounts, weightRemaining] = calculatePlates(totalWeight, barWeight);

                                // Determines result HTML
                                let resultHTML = '';
                                for (let i = 0; i < plateCounts.length; i++) {
                                    if (plateCounts[i] > 0) {
                                        resultHTML += plateCounts[i] + ' x ' + PLATE_WEIGHTS[i] + ' lb<br>';
                                    }
                                }
                                if (weightRemaining > 0) {
                                    resultHTML += '+' + weightRemaining + ' lbs extra<br>';
                                }

                                $('#plate-calculator-result').html(resultHTML);
                            });
                        </script>

                    </div>

                </div>
            </div>
        </div>
    </div>



    <!-- Loads jQuery scripts from static folder (Flask thing) -->
    <link rel="stylesheet" href="{{ url_for('static', filename='css/select_equipment_modal.css') }}" />







    <button class="btn-grey btn btn-dark square-btn btn-m-l">
        B
    </button>
    <button class="btn-grey btn btn-dark square-btn btn-m-l">
        C
    </button>
    <button class="btn-grey btn btn-dark square-btn btn-m-l">
        D
    </button>

    <style>
        .square-btn {
            width: 50px;
            height: 50px;
            font-size: 1.5rem;
            text-align: center;
            line-height: 1.2;
            padding: 0;
        }

    </style>

</body>

</html>
